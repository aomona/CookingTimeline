<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パスタレシピ - タイムライン UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="max-w-7xl mx-auto p-6 min-h-screen">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="h-8 w-8 text-orange-500 flex items-center justify-center text-2xl">👨‍🍳</div>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900" id="recipe-title">パスタ</h1>
                        <div class="flex items-center gap-4 mt-2 text-gray-600">
                            <div class="flex items-center gap-1">
                                <span class="text-sm">👥</span>
                                <span id="servings">2人前</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <span class="text-sm">⏰</span>
                                <span id="total-time">約24分</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="flex items-center gap-4">
                    <select id="speed-select" class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="0.5">0.5x</option>
                        <option value="1" selected>1x</option>
                        <option value="2">2x</option>
                        <option value="4">4x</option>
                    </select>
                    
                    <button id="reset-btn" class="flex items-center gap-2 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors">
                        <span class="text-sm">↻</span>
                        リセット
                    </button>
                    
                    <button id="play-pause-btn" class="flex items-center gap-2 px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors">
                        <span id="play-icon" class="text-sm">▶</span>
                        <span id="play-text">スタート</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Current Time Display -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
            <div class="flex items-center justify-between">
                <div class="text-2xl font-bold text-blue-600">
                    現在時刻: <span id="current-time-display">0:00</span> / <span id="total-time-display">24:00</span>
                </div>
                <div class="w-1/2 bg-gray-200 rounded-full h-3">
                    <div id="progress-bar" class="bg-blue-500 h-3 rounded-full transition-all duration-100" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Timeline Visualization -->
            <div class="lg:col-span-2 bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4">タイムライン</h2>
                
                <!-- Time Scale -->
                <div class="relative mb-4">
                    <div class="flex justify-between text-xs text-gray-500 mb-2" id="time-scale">
                        <!-- Time markers will be generated by JavaScript -->
                    </div>
                    <div class="relative h-2 bg-gray-200 rounded">
                        <div id="time-indicator" class="absolute top-0 w-1 h-4 bg-red-500 rounded transform -translate-x-1/2 transition-all duration-100" style="left: 0%"></div>
                    </div>
                </div>

                <!-- Timeline Steps -->
                <div class="space-y-3" id="timeline-steps">
                    <!-- Steps will be generated by JavaScript -->
                </div>
            </div>

            <!-- Current Instructions -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4">現在の作業</h2>
                <div id="current-instructions">
                    <div class="text-center p-8 text-gray-500">
                        <div class="text-4xl mb-4 opacity-50">⏰</div>
                        <p>スタートボタンを押して調理を始めましょう</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Materials List -->
        <div class="mt-6 bg-white rounded-lg shadow-sm p-6">
            <h2 class="text-xl font-semibold mb-4">材料一覧</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3" id="materials-list">
                <!-- Materials will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Recipe data
        const recipe = {
            title: "パスタ",
            servings: 2,
            totalTime: 24,
            materials: [
                { id: "1", name: "パスタ", amount: "160g" },
                { id: "2", name: "水(茹で用)", amount: "1000ml" },
                { id: "3", name: "塩(茹で用)", amount: "小さじ2" },
                { id: "4", name: "オリーブオイル", amount: "小さじ2" },
                { id: "5", name: "にんにく", amount: "1片" },
                { id: "6", name: "鷹の爪輪切り", amount: "少々" },
                { id: "7", name: "ホワイトマッシュルーム", amount: "40g" },
                { id: "8", name: "厚切りハーフベーコン", amount: "40g" },
                { id: "9", name: "パセリ (生)", amount: "適量" },
                { id: "10", name: "黒こしょう", amount: "少々" },
                { id: "11", name: "塩", amount: "少々" }
            ],
            steps: [
                {
                    id: "boil",
                    label: "湯を沸かす",
                    timeline: { start: 0, end: 10 },
                    time: 10,
                    req: { stove: 1 },
                    uses: ["2", "3"],
                    instructions: "大きめの鍋に水(1000ml)を入れ中火で加熱し、沸騰直前に塩(茹で用)を加える。",
                    color: "bg-blue-500"
                },
                {
                    id: "chop",
                    label: "食材を切る",
                    timeline: { start: 3, end: 8 },
                    time: 5,
                    req: { hands: 1 },
                    uses: ["5", "6", "7", "8", "9"],
                    instructions: "にんにくをみじん切り。鷹の爪は輪切りをそのまま。マッシュルームは薄切り。ベーコンは短冊。パセリは仕上げ用にみじん切り。",
                    color: "bg-green-500"
                },
                {
                    id: "boilP",
                    label: "パスタを茹でる",
                    timeline: { start: 10, end: 19 },
                    time: 9,
                    req: { stove: 1 },
                    after: ["boil"],
                    uses: ["1", "2", "3"],
                    instructions: "沸いた鍋にパスタを入れ、表示時間より1分短く茹でる(ここでは9分想定)。軽くかき混ぜてくっつきを防ぐ。",
                    color: "bg-orange-500"
                },
                {
                    id: "saute",
                    label: "食材を炒める",
                    timeline: { start: 14, end: 19 },
                    time: 5,
                    req: { hands: 1, stove: 1 },
                    after: ["chop"],
                    uses: ["4", "5", "6", "7", "8"],
                    instructions: "フライパンにオリーブオイルを熱し、弱めの中火でにんにく・鷹の爪を香りが出るまで炒め、マッシュルームとベーコンを加え旨味を引き出す。焦げないよう火加減調整。",
                    color: "bg-red-500"
                },
                {
                    id: "mix",
                    label: "和える",
                    timeline: { start: 20, end: 24 },
                    time: 4,
                    req: { hands: 1 },
                    after: ["saute", "boilP"],
                    uses: ["1", "4", "9", "10", "11"],
                    instructions: "茹で上がったパスタの湯を切り(少量の茹で汁を取っておく)、ソースと和える。硬さを茹で汁で調整。仕上げにパセリ・黒こしょう・塩・オイル少量。",
                    color: "bg-purple-500"
                }
            ]
        };

        // App state
        let currentTime = 0;
        let isPlaying = false;
        let playbackSpeed = 1;
        let intervalId = null;

        // DOM elements
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const playText = document.getElementById('play-text');
        const resetBtn = document.getElementById('reset-btn');
        const speedSelect = document.getElementById('speed-select');
        const currentTimeDisplay = document.getElementById('current-time-display');
        const totalTimeDisplay = document.getElementById('total-time-display');
        const progressBar = document.getElementById('progress-bar');
        const timeIndicator = document.getElementById('time-indicator');

        // Helper functions
        function formatTime(time) {
            const minutes = Math.floor(time);
            const seconds = Math.floor((time - minutes) * 60);
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function isStepActive(step) {
            return currentTime >= step.timeline.start && currentTime <= step.timeline.end;
        }

        function isStepCompleted(step) {
            return currentTime > step.timeline.end;
        }

        function getCurrentSteps() {
            return recipe.steps.filter(step => isStepActive(step));
        }

        function getMaterialName(id) {
            const material = recipe.materials.find(m => m.id === id);
            return material ? `${material.name}(${material.amount})` : '';
        }

        // Initialize UI
        function initializeUI() {
            // Set total time display
            totalTimeDisplay.textContent = formatTime(recipe.totalTime);
            
            // Generate time scale
            const timeScale = document.getElementById('time-scale');
            const markers = Math.ceil(recipe.totalTime / 5) + 1;
            for (let i = 0; i < markers; i++) {
                const span = document.createElement('span');
                span.textContent = `${i * 5}分`;
                timeScale.appendChild(span);
            }

            // Generate timeline steps
            const timelineSteps = document.getElementById('timeline-steps');
            recipe.steps.forEach((step) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'relative';
                stepElement.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div id="step-status-${step.id}" class="w-3 h-3 rounded-full bg-gray-300"></div>
                        <div class="flex-1">
                            <div class="relative">
                                <div class="h-8 bg-gray-200 rounded relative overflow-hidden">
                                    <div 
                                        class="absolute top-0 left-0 h-full ${step.color} opacity-30 rounded"
                                        style="left: ${(step.timeline.start / recipe.totalTime) * 100}%; width: ${((step.timeline.end - step.timeline.start) / recipe.totalTime) * 100}%"
                                    ></div>
                                    <div class="absolute inset-0 flex items-center px-3">
                                        <span id="step-label-${step.id}" class="font-medium text-gray-600">
                                            ${step.label}
                                        </span>
                                        <span class="ml-auto text-sm text-gray-500">
                                            ${step.timeline.start}-${step.timeline.end}分
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                timelineSteps.appendChild(stepElement);
            });

            // Generate materials list
            const materialsList = document.getElementById('materials-list');
            recipe.materials.forEach(material => {
                const materialElement = document.createElement('div');
                materialElement.className = 'flex items-center gap-2 p-3 bg-gray-50 rounded-lg';
                materialElement.innerHTML = `
                    <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
                    <span class="font-medium">${material.name}</span>
                    <span class="text-gray-600 ml-auto">${material.amount}</span>
                `;
                materialsList.appendChild(materialElement);
            });
        }

        // Update UI based on current time
        function updateUI() {
            // Update time displays
            currentTimeDisplay.textContent = formatTime(currentTime);
            const progress = (currentTime / recipe.totalTime) * 100;
            progressBar.style.width = `${progress}%`;
            timeIndicator.style.left = `${progress}%`;

            // Update step statuses
            recipe.steps.forEach(step => {
                const statusElement = document.getElementById(`step-status-${step.id}`);
                const labelElement = document.getElementById(`step-label-${step.id}`);
                
                if (isStepCompleted(step)) {
                    statusElement.className = 'w-3 h-3 rounded-full bg-green-500';
                    labelElement.className = 'font-medium text-gray-600';
                } else if (isStepActive(step)) {
                    statusElement.className = 'w-3 h-3 rounded-full bg-yellow-400 animate-pulse';
                    labelElement.className = 'font-medium text-gray-900';
                } else {
                    statusElement.className = 'w-3 h-3 rounded-full bg-gray-300';
                    labelElement.className = 'font-medium text-gray-600';
                }
            });

            // Update current instructions
            updateCurrentInstructions();
        }

        function updateCurrentInstructions() {
            const currentInstructions = document.getElementById('current-instructions');
            const activeSteps = getCurrentSteps();

            if (activeSteps.length > 0) {
                currentInstructions.innerHTML = activeSteps.map(step => {
                    const stepProgress = Math.min(100, Math.max(0, 
                        ((currentTime - step.timeline.start) / (step.timeline.end - step.timeline.start)) * 100
                    ));

                    const reqText = Object.entries(step.req).map(([key, value]) => 
                        `${key === 'stove' ? 'コンロ' : key === 'hands' ? '手' : key}: ${value}`
                    ).join(', ');

                    return `
                        <div class="p-4 rounded-lg border-l-4 border-l-blue-500 bg-gray-50 mb-4">
                            <h3 class="font-semibold text-lg mb-2">${step.label}</h3>
                            <p class="text-gray-700 mb-3">${step.instructions}</p>
                            
                            <div class="space-y-2">
                                <div class="text-sm">
                                    <span class="font-medium">使用する材料:</span>
                                    <ul class="mt-1 space-y-1">
                                        ${step.uses.map(materialId => `
                                            <li class="text-gray-600">• ${getMaterialName(materialId)}</li>
                                        `).join('')}
                                    </ul>
                                </div>
                                
                                <div class="text-sm">
                                    <span class="font-medium">必要なもの:</span>
                                    <span class="ml-2 text-gray-600">${reqText}</span>
                                </div>
                                
                                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div class="h-2 rounded-full transition-all duration-100 ${step.color}" style="width: ${stepProgress}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else if (currentTime >= recipe.totalTime) {
                currentInstructions.innerHTML = `
                    <div class="text-center p-8">
                        <div class="text-6xl mb-4">🎉</div>
                        <h3 class="text-xl font-semibold text-green-600 mb-2">完成！</h3>
                        <p class="text-gray-600">美味しいパスタの出来上がりです</p>
                    </div>
                `;
            } else {
                currentInstructions.innerHTML = `
                    <div class="text-center p-8 text-gray-500">
                        <div class="text-4xl mb-4 opacity-50">⏰</div>
                        <p>スタートボタンを押して調理を始めましょう</p>
                    </div>
                `;
            }
        }

        // Timer functions
        function startTimer() {
            if (intervalId) clearInterval(intervalId);
            
            intervalId = setInterval(() => {
                if (currentTime >= recipe.totalTime) {
                    stopTimer();
                    return;
                }
                currentTime += 0.1 * playbackSpeed;
                updateUI();
            }, 100);
        }

        function stopTimer() {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
            isPlaying = false;
            playIcon.textContent = '▶';
            playText.textContent = 'スタート';
        }

        function resetTimer() {
            stopTimer();
            currentTime = 0;
            updateUI();
        }

        // Event listeners
        playPauseBtn.addEventListener('click', () => {
            if (isPlaying) {
                stopTimer();
            } else {
                isPlaying = true;
                playIcon.textContent = '⏸';
                playText.textContent = 'ポーズ';
                startTimer();
            }
        });

        resetBtn.addEventListener('click', resetTimer);

        speedSelect.addEventListener('change', (e) => {
            playbackSpeed = parseFloat(e.target.value);
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            initializeUI();
            updateUI();
        });
    </script>
</body>
</html>
